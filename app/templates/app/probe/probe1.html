{% extends 'app/layouts/main.html' %}
{% block title %}
Probe-1 Page
{% endblock title %}
{% block content %}

<pre id="selected-probe" style="color: white; text-shadow: 2px 2px 4px #000000;
margin-left: 400px;font-size:30px;">
Selected Probe
</pre>
{% include 'app/inc/nav.html' %}

<div class="container" style="background-color: white;margin-top: 10px;">
    <div class="card">
        <div class="card-image"></div>
        <section class="container-a"><b>Probe Count</b></section>
        <section class="container-b"><b>Coefficient</b></section>
        <section class="container-c"><b>Probe Correction</b></section>
        <section class="container-d"><b>High Ref.Value</b></section>
        <section class="container-e"><b>Low Ref.Value</b></section>
        <section class="container-f"><b>Reading</b></section>
    </div>

    <div class="card">
        <input type="radio" name="size" id="Probe-1">
        <label for="Probe-1"><b>Probe-1</b></label>
        <textarea id="probe-A" readonly style="max-height: 100px;"></textarea>
        <section class="container-b"></section>
        <section class="container-c"></section>
        <input type="text" class="container-d">
        <input type="text" class="container-e">
        <section class="container-f"></section>
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-2">
        <label for="Probe-2"><b>Probe-2</b></label>
        <textarea id="probe-B" readonly style="max-height: 100px;"></textarea>
        <section class="container-b"></section>
        <section class="container-c"></section>
        <input type="text" class="container-d">
        <input type="text" class="container-e">
        <section class="container-f"></section>
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-3">
        <label for="Probe-3"><b>Probe-3</b></label>
        <textarea id="probe-C" readonly style="max-height: 100px;"></textarea>
        <section class="container-b"></section>
        <section class="container-c"></section>
        <input type="text" class="container-d">
        <input type="text" class="container-e">
        <section class="container-f"></section>
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-4">
        <label for="Probe-4"><b>Probe-4</b></label>
        <textarea id="probe-D" readonly style="max-height: 100px;"></textarea>
        <section class="container-b"></section>
        <section class="container-c"></section>
        <input type="text" class="container-d">
        <input type="text" class="container-e">
        <section class="container-f"></section>
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-5">
        <label for="Probe-5"><b>Probe-5</b></label>
        <textarea id="probe-E" readonly style="max-height: 100px;"></textarea>
        <section class="container-b"></section>
        <section class="container-c"></section>
        <input type="text" class="container-d">
        <input type="text" class="container-e">
        <section class="container-f"></section>
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-6">
        <label for="Probe-6"><b>Probe-6</b></label>
        <textarea id="probe-F" readonly style="max-height: 100px;"></textarea>
        <section class="container-b"></section>
        <section class="container-c"></section>
        <input type="text" class="container-d">
        <input type="text" class="container-e">
        <section class="container-f"></section>
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-7">
        <label for="Probe-7"><b>Probe-7</b></label>
        <textarea id="probe-G" readonly style="max-height: 100px;"></textarea>
        <section class="container-b"></section>
        <section class="container-c"></section>
        <input type="text" class="container-d">
        <input type="text" class="container-e">
        <section class="container-f"></section>
    </div>

    <!-- Repeat the above structure for channels H to K -->

</div>

<pre id="calibration-info" style="color: white; text-shadow: 2px 2px 4px #000000; margin-top: 5px; margin-left: 250px; font-size: 20px;">
    Load probe at middle and do LOW Calibration for selected probe
</pre>

<button type="button" style="background-color: green; color: white;margin-top: 10px;height: 50px; width: 250px;margin-left: 80px;"onclick="performCalibration('low')"><b>Low Reference</b></button>
<button type="button" style="background-color: green; color: white;margin-top: 10px;height: 50px; width: 250px;margin-left: 80px;" onclick="performCalibration('high')"><b>High Reference</b></button>

<a href="{% url 'index' %}" style="text-decoration: none;">
    <button type="button" id="cancel-button"  style="background-color: red; color: white;margin-top: 10px;height: 30px; width: 200px;margin-left: 400px;"><b>BACK</b></button>
</a>
<script>
    function updateSerialData() {
        // Make an AJAX request to your Django view
        $.ajax({
            url: '/probe1/',  // Replace with the correct URL
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                var serialData = data.serial_data;

                // Update the textarea with data from data_to_display
                $('#probe-A').text(serialData['A']);
                $('#probe-B').text(serialData['B']);
                $('#probe-C').text(serialData['C']);
                $('#probe-D').text(serialData['D']);
                $('#probe-E').text(serialData['E']);
                $('#probe-F').text(serialData['F']);
                $('#probe-G').text(serialData['G']);
                // Add similar lines for other probes

                // Scroll the textarea to view the last line
                $('.card textarea').each(function() {
                    $(this).scrollTop($(this)[0].scrollHeight);
                });
            },
            error: function(error) {
                console.error('Error updating serial data:', error);
            }
        });
    }
    setInterval(updateSerialData, 0.5); 

    var probeIds = ['Probe-1', 'Probe-2', 'Probe-3', 'Probe-4', 'Probe-5', 'Probe-6', 'Probe-7'];
    var currentProbeIndex = 0;


    function performCalibration(calibrationType) {
        // Change the text in the <pre> tag based on calibration type
        if (calibrationType === 'low') {
            $('#calibration-info').text('LOW Calibration completed. Do HIGH Calibration for selected probe');
        } else if (calibrationType === 'high') {
            moveToNextProbe();
        }
    }

    function moveToNextProbe() {
        // Move to the next probe
        currentProbeIndex = (currentProbeIndex + 1) % probeIds.length;

        // Display default values in the <pre> tag
        var defaultInfo = 'Default values for ' + probeIds[currentProbeIndex];
        $('#calibration-info').text(defaultInfo);

        // Reset color for all probes
        $('.card').css('background-color', '');

        // Check the radio button for the next probe
        $('#' + probeIds[currentProbeIndex]).prop('checked', true);
        $('#' + probeIds[currentProbeIndex]).closest('.card').css('background-color', 'red'); // Change to your desired color
    }

    // Update the serial data every 1 second (adjust the interval as needed)
    setInterval(updateSerialData, 1000); 

    

    $('input[type="radio"]').on('change', function() {
        // Reset color for all probes
        $('.card').css('background-color', '');

        // Change the color of the selected probe
        if ($(this).prop('checked')) {
            var selectedProbe = $(this).attr('id');
            $('#' + selectedProbe).closest('.card').css('background-color', 'red'); // Change to your desired color
            
            // Display the selected probe in the <pre> tag
            $('#selected-probe').text('Selected Probe: ' + selectedProbe);
        }
    });
</script>

{% endblock %}
