{% extends 'app/layouts/main.html' %}
{% block title %}
Probe-1 Page
{% endblock title %}
{% block content %}
<center style="color: white; text-shadow: 2px 2px 4px #000000;">
    <h1>PROBE CALIBRATION</h1>
</center>
{% include 'app/inc/nav.html' %}
<div class="container">
    <div class="card">
        <div class="card-image"></div>
        <section class="container-a"><b>Probe Count</b></section>
        <section class="container-b"><b>Coefficient</b></section>
        <section class="container-c"><b>Probe Correction</b></section>
        <section class="container-d"><b>High Ref.Value</b></section>
        <section class="container-e"><b>Low Ref.Value</b></section>
        <section class="container-f"><b>Reading</b></section>
    </div>

    <div class="card">
        <input type="radio" name="size" id="Probe-1" onclick="setCurrentProbe('Probe-1')">
        <label for="Probe-1"><b>Probe-1</b></label>
        <textarea id="probe-A"  style="max-height: 100px;"></textarea>
        <input type="text" class="container-b" id="container-b-1">
        <section class="container-c">0.0001</section>
        <input type="text" class="container-d" id="container-d-1">
        <input type="text" class="container-e" id="container-e-1" oninput="checkProbeAndEnterValue('Probe-1', this.value)">
        <input type="text" class="container-f" id="container-f-1">
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-2" onclick="setCurrentProbe('Probe-2')">
        <label for="Probe-2"><b>Probe-2</b></label>
        <textarea id="probe-B" style="max-height: 100px;"></textarea>
        <input type="text" class="container-b" id="container-b-2">
        <section class="container-c">0.0001</section>
        <input type="text" class="container-d" id="container-d-2">
        <input type="text" class="container-e" id="container-e-2" oninput="checkProbeAndEnterValue('Probe-2', this.value)">
        <input type="text" class="container-f" id="container-f-2">
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-3" onclick="setCurrentProbe('Probe-3')">
        <label for="Probe-3"><b>Probe-3</b></label>
        <textarea id="probe-C" style="max-height: 100px;"></textarea>
        <input type="text" class="container-b" id="container-b-3">
        <section class="container-c">""</section>
        <input type="text" class="container-d" id="container-d-3">
        <input type="text" class="container-e" id="container-e-3" oninput="checkProbeAndEnterValue('Probe-3', this.value)">
        <input type="text" class="container-f" id="container-f-3">
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-4" onclick="setCurrentProbe('Probe-4')">
        <label for="Probe-4"><b>Probe-4</b></label>
        <textarea id="probe-D" style="max-height: 100px;"></textarea>
        <input type="text" class="container-b" id="container-b-4">
        <section class="container-c">""</section>
        <input type="text" class="container-d" id="container-d-4">
        <input type="text" class="container-e" id="container-e-4" oninput="checkProbeAndEnterValue('Probe-4', this.value)">
        <input type="text" class="container-f" id="container-f-4">
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-5" onclick="setCurrentProbe('Probe-5')">
        <label for="Probe-5"><b>Probe-5</b></label>
        <textarea id="probe-E" style="max-height: 100px;"></textarea>
        <input type="text" class="container-b" id="container-b-5">
        <section class="container-c">""</section>
        <input type="text" class="container-d" id="container-d-5">
        <input type="text" class="container-e" id="container-e-5" oninput="checkProbeAndEnterValue('Probe-5', this.value)">
        <input type="text" class="container-f" id="container-f-5">
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-6" onclick="setCurrentProbe('Probe-6')">
        <label for="Probe-6"><b>Probe-6</b></label>
        <textarea id="probe-F" style="max-height: 100px;"></textarea>
        <input type="text" class="container-b" id="container-b-6">
        <section class="container-c">""</section>
        <input type="text" class="container-d" id="container-d-6">
        <input type="text" class="container-e" id="container-e-6" oninput="checkProbeAndEnterValue('Probe-6', this.value)">
        <input type="text" class="container-f" id="container-f-6">
    </div>
    <div class="card">
        <input type="radio" name="size" id="Probe-7" onclick="setCurrentProbe('Probe-7')">
        <label for="Probe-7"><b>Probe-7</b></label>
        <textarea id="probe-G" style="max-height: 100px;"></textarea>
        <input type="text" class="container-b" id="container-b-7">
        <section class="container-c">""</section>
        <input type="text" class="container-d" id="container-d-7">
        <input type="text" class="container-e" id="container-e-7" oninput="checkProbeAndEnterValue('Probe-7', this.value)">
        <input type="text" class="container-f" id="container-f-7">
    </div>

    <!-- Repeat the above structure for channels H to K -->

</div>
<button onclick="captureLowReference()" type="button" style="background-color: green; color: white;margin-top: 20px;height: 50px; width: 250px;margin-left: 80px;"><b>Low Reference</b></button>
<button onclick="captureHighReference()" type="button" style="background-color: green; color: white;margin-top: 20px;height: 50px; width: 250px;margin-left: 80px;"><b>High Reference</b></button>

<a href="{% url 'index' %}" style="text-decoration: none;">
    <button type="button" id="cancel-button"  style="background-color: red; color: white;margin-top: 20px;height: 30px; width: 200px;margin-left: 400px;"><b>BACK</b></button>
</a>
<script>
    function updateSerialData() {
        // Make an AJAX request to your Django view
        $.ajax({
            url: '/probe1/',  // Replace with the correct URL
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                var serialData = data.serial_data;

                // Update the textarea with data from data_to_display
                $('#probe-A').text(serialData['A']);
                $('#probe-B').text(serialData['B']);
                $('#probe-C').text(serialData['C']);
                $('#probe-D').text(serialData['D']);
                $('#probe-E').text(serialData['E']);
                $('#probe-F').text(serialData['F']);
                $('#probe-G').text(serialData['G']);
                // Add similar lines for other probes

                // Scroll the textarea to view the last line
                $('.card textarea').each(function() {
                    $(this).scrollTop($(this)[0].scrollHeight);
                });
            },
            error: function(error) {
                console.error('Error updating serial data:', error);
            }
        });
    }

    // Update the serial data every 1 second (adjust the interval as needed)
    setInterval(updateSerialData, 0.5); // Update every second (1000 ms)


     // Add an event listener to radio buttons to change the color of the selected probe
     $('input[type="radio"]').on('change', function() {
        // Reset color for all probes
        $('.card').css('background-color', '');

        // Change the color of the selected probe
        if ($(this).prop('checked')) {
            var selectedProbe = $(this).attr('id');
            $('#' + selectedProbe).closest('.card').css('background-color', 'red'); // Change to your desired color
            
            // Display the selected probe in the <pre> tag
            $('#selected-probe').text('Selected Probe: ' + selectedProbe);
        }
    });


    //probe selection javascript code
    var currentProbe = null;

        function setCurrentProbe(probeId) {
            currentProbe = probeId;
        }

        function checkProbeAndEnterValue(probeId, enteredValue) {
            if (!currentProbe) {
                alert("Please select a probe before entering values.");
                clearEnteredValue();
            } else if (probeId !== currentProbe) {
                alert("Please enter values only for the selected probe.");
                clearEnteredValue();
            }
        }

        function clearEnteredValue() {
            var inputFields = document.querySelectorAll('.card input[type="text"]');
            inputFields.forEach(function(field) {
                field.value = "";
            });
        }

        
        
        let a = [];
        let b = [];
        let c = [];
        let a1 = [];
        let b1 = [];
        let c1 = [];

        function captureLowReference() {
            const probeValues = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];
            a = [];
            a1 = [];

            for (let i = 0; i < 7; i++) {
                const element = document.getElementById(`container-e-${i + 1}`);
                if (element) {
                    const aValue = parseFloat(element.value);
                    a.push(!isNaN(aValue) ? aValue : NaN);
                }

                const probeElement = document.getElementById(`probe-${probeValues[i]}`);
                if (probeElement) {
                    const a1Value = parseFloat(probeElement.value);
                    a1.push(!isNaN(a1Value) ? a1Value : NaN);
                }
            }
            console.log('Captured low reference values:', a, a1);
            
        }

        function captureHighReference() {
            const probeValues = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];
            b = [];
            b1 = [];
            c = [];
            c1 = [];

            for (let i = 0; i < 7; i++) {
                const element = document.getElementById(`container-d-${i + 1}`);
                if (element) {
                    const bValue = parseFloat(element.value);
                    b.push(!isNaN(bValue) ? bValue : NaN);
                }

                const probeElement = document.getElementById(`probe-${probeValues[i]}`);
                if (probeElement) {
                    const b1Value = parseFloat(probeElement.value);
                    b1.push(!isNaN(b1Value) ? b1Value : NaN);
                }

                if (!isNaN(b[i]) && !isNaN(b1[i]) && !isNaN(a[i]) && !isNaN(a1[i])) {
                    const cValue = b[i] - a[i];
                    const c1Value = b1[i] - a1[i];
                    c.push(cValue);
                    c1.push(c1Value);

                    if (c1Value !== 0) {
                        const d = cValue / c1Value;
                        const e = d / 1000;

                        const containerBElement = document.getElementById(`container-b-${i + 1}`);
                        const containerFElement = document.getElementById(`container-f-${i + 1}`);
                        if (containerBElement && containerFElement) {
                            containerBElement.value = e.toFixed(12);
                        
                        }
                    }
                }
            }

            console.log('Captured high reference values:', b, b1, c, c1);
            
        }


</script>

{% endblock %}
