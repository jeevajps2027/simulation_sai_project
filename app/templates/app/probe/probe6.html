<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Table</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }

        input {
            width: 100%;
            padding: 0;
            border: none;
            outline: none;
        }
    </style>
</head>
<body>
    <div class="box-1">
        <div id="part" class="inner-box-1" onclick="enlargeItem(1),showItem('item-1')"><h4><b>Part</b></h4></div>
        <div id="batchNumber" class="inner-box-2" onclick="enlargeItem(2),showItem('item-2'), highlightColumn('item-2', 2)"><h4><b>Batch Number</b></h4></div>
        <div id="machine" class="inner-box-3" onclick="enlargeItem(3),showItem('item-3')"><h4><b>Machine</b></h4></div>
        <div id="operator" class="inner-box-4" onclick="enlargeItem(4),showItem('item-4')"><h4><b>Operator</b></h4></div>
        <div id="vendorCode" class="inner-box-5" onclick="enlargeItem(5),showItem('item-5')"><h4><b>Vendor Code</b></h4></div>
    </div>
    
    <div class="box" id="boxContent" style="overflow-x: auto;overflow-y:auto;">
        <div class="item item-2">
            <table border="1">
                <thead>
                    <tr>
                        <th style="width: 5%;">Sr.No</th>
                        <th style="width: 20%;">Batch No</th>
                    </tr>
                </thead>
                <tbody id="tableBody-2"></tbody>
            </table><br>
            <button onclick="addRow('item-2', 3)">Add New</button>
        </div>
    </div>
    
    <button type="button" id="save-btn" onclick="saveData()"><b>Save</b></button>
    <button type="button" id="delete-btn" onclick="deleteSelectedRows()"><b>Delete Selected</b></button>
    
    <a href="{% url 'index' %}">
        <button type="button" id="cancel-btn"><b>Cancel</b></button>
    </a>
    
    <script>
        var highlightedColumn = null;
    
        function highlightColumn(itemClassName, columnIndex) {
            highlightedColumn = {
                itemClassName: itemClassName,
                columnIndex: columnIndex
            };
            document.querySelector(`.${itemClassName} table thead th:nth-child(${columnIndex + 1})`).style.backgroundColor = 'blue';
        }
    
        function enlargeItem(index) {
            document.querySelectorAll('.box-1 > div').forEach(function (el) {
                el.style.backgroundColor = '';
            });
            var clickedInnerBox = document.querySelector(`.box-1 .inner-box-${index}`);
            clickedInnerBox.style.backgroundColor = 'red';
        }
    
        function showItem(itemClassName) {
            var itemClasses = document.querySelectorAll('.item');
            itemClasses.forEach(function (item) {
                item.style.display = 'none';
            });
    
            var selectedItem = document.querySelector('.' + itemClassName);
            if (selectedItem) {
                selectedItem.style.display = 'block';
            }
        }
    
        var rowData = {};
    
        window.onload = function () {
            rowData = loadData() || {};
            populateTables();
            showItem('item-2');
        };
    
        function loadData() {
            var savedData = localStorage.getItem('tableData');
            return savedData ? JSON.parse(savedData) : {};
        }
    
        function saveData() {
            var tables = document.querySelectorAll('.item');
            tables.forEach((table, index) => {
                var tableBodyId = 'tableBody-' + (index + 1);
                var tableBody = table.querySelector('#' + tableBodyId);
    
                rowData[tableBodyId] = [];
    
                for (var i = 0; i < tableBody.rows.length; i++) {
                    var row = tableBody.rows[i];
                    var rowDataIndex = rowData[tableBodyId].findIndex(data => data.rowIndex === i + 1);
                    if (rowDataIndex === -1) {
                        rowData[tableBodyId].push({
                            rowIndex: i + 1,
                            values: []
                        });
                        rowDataIndex = rowData[tableBodyId].length - 1;
                    }
    
                    for (var j = 1; j < row.cells.length; j++) {
                        var input = row.cells[j].querySelector('input');
                        rowData[tableBodyId][rowDataIndex].values[j - 1] = input.value;
                    }
                }
    
                // Check if a column is highlighted, and save the highlighted value
                if (highlightedColumn && highlightedColumn.itemClassName === `item-${index + 1}`) {
                    var columnIndex = highlightedColumn.columnIndex;
                    rowData[tableBodyId].forEach(data => {
                        data.values[columnIndex - 1] = 'Shift-' + (columnIndex);
                    });
    
                    // Reset the highlighted column
                    highlightedColumn = null;
                    document.querySelector(`.${highlightedColumn.itemClassName} table thead th:nth-child(${columnIndex + 1})`).style.backgroundColor = '';
                }
            });
    
            localStorage.setItem('tableData', JSON.stringify(rowData));
            console.log('Data saved:', rowData);
        }
    
        function addRow(itemClassName, numColumns) {
            var tableBodyId = 'tableBody-' + itemClassName.charAt(itemClassName.length - 1);
            var tableBody = document.querySelector('#' + tableBodyId);
            var newRow = tableBody.insertRow(tableBody.rows.length);
    
            var rowIndex = tableBody.rows.length;
    
            var serialCell = newRow.insertCell(0);
            serialCell.textContent = rowIndex;
    
            for (var i = 1; i < numColumns; i++) {
                var cell = newRow.insertCell(i);
                var input = document.createElement('input');
                input.type = 'text';
                input.style.width = '100%';
                input.style.padding = '0';
                input.style.border = 'none';
                input.style.outline = 'none';
                cell.appendChild(input);
            }
        }
    
        function populateTables() {
            var tables = document.querySelectorAll('.item');
            tables.forEach((table, index) => {
                var tableBodyId = 'tableBody-' + (index + 1);
                var tableBody = table.querySelector('#' + tableBodyId);
    
                if (rowData[tableBodyId]) {
                    for (var i = 0; i < rowData[tableBodyId].length; i++) {
                        var data = rowData[tableBodyId][i];
                        var newRow = tableBody.insertRow(tableBody.rows.length);
    
                        var serialCell = newRow.insertCell(0);
                        serialCell.textContent = data.rowIndex;
    
                        for (var j = 0; j < data.values.length; j++) {
                            var cell = newRow.insertCell(j + 1);
                            var input = document.createElement('input');
                            input.type = 'text';
                            input.style.width = '100%';
                            input.style.padding = '0';
                            input.style.border = 'none';
                            input.style.outline = 'none';
                            input.value = data.values[j];
                            cell.appendChild(input);
                        }
                    }
                }
            });
        }
    </script>

</body>
</html>
